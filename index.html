<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Order Data Entry</title>
    <style>
        /* ‰øùÊåÅÂéüÊúâÁöÑÊâÄÊúâCSSÊ†∑Âºè‰∏çÂèò */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 800px;
            padding: 30px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 600;
        }
        
        .config-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            border-left: 4px solid #4CAF50;
        }
        
        .config-section h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .config-input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .date-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
            text-align: center;
            border-left: 4px solid #667eea;
        }
        
        .current-month {
            font-size: 18px;
            color: #667eea;
            font-weight: 600;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 500;
            color: #555;
            margin-bottom: 6px;
            font-size: 14px;
        }
        
        input, select {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            padding: 14px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-width: 200px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn:active {
            transform: translateY(0);
        }
        
        .reset-btn {
            background-color: #f8f9fa;
            color: #666;
            border: 1px solid #ddd;
        }
        
        .reset-btn:hover {
            background-color: #e9ecef;
        }
        
        .status-message {
            margin-top: 20px;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .loading {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        @media (max-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 20px;
            }
            
            .button-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã Sales Order Entry System</h1>
        
        <!-- Configuration Section -->
        <div class="config-section" id="configSection">
            <h3>üîß Configuration (Required)</h3>
            <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
                Before submitting data, please enter your Google Apps Script Web App URL below.
                <br><strong>Step 1:</strong> Deploy the GAS script as a web app (Anyone, even anonymous).
                <br><strong>Step 2:</strong> Copy the web app URL and paste it here.
            </p>
            <input type="text" id="gasUrl" class="config-input" 
                   placeholder="https://script.google.com/macros/s/XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/exec">
            <button type="button" onclick="saveConfig()" style="background-color: #4CAF50; color: white; padding: 10px 20px;">
                Save Configuration
            </button>
            <div id="configStatus" style="margin-top: 10px; display: none;"></div>
        </div>
        
        <!-- Date Information -->
        <div class="date-info">
            <div class="current-month" id="currentMonth"></div>
            <div style="margin-top: 8px; color: #666; font-size: 14px;">
                Data will be saved to the corresponding Google Sheet for this month
            </div>
            <div style="margin-top: 8px; color: #666; font-size: 12px;" id="targetSheetInfo"></div>
        </div>
        
        <!-- Main Form -->
        <form id="salesForm">
            <div class="form-grid">
                <div class="form-group">
                    <label for="salesOrder">Sales Order No. *</label>
                    <input type="text" id="salesOrder" name="salesOrder" required 
                           placeholder="e.g., SO-2025-001">
                </div>
                
                <div class="form-group">
                    <label for="customerName">Customer Name *</label>
                    <input type="text" id="customerName" name="customerName" required 
                           placeholder="e.g., ABC Corporation">
                </div>
                
                <div class="form-group">
                    <label for="itemNo">Item No. *</label>
                    <input type="text" id="itemNo" name="itemNo" required 
                           placeholder="e.g., ITM-001">
                </div>
                
                <div class="form-group">
                    <label for="itemName">Item Name *</label>
                    <input type="text" id="itemName" name="itemName" required 
                           placeholder="e.g., Widget Pro">
                </div>
                
                <div class="form-group full-width">
                    <label for="dimension">Dimension</label>
                    <input type="text" id="dimension" name="dimension" 
                           placeholder="e.g., 100x200x50 mm">
                </div>
                
                <div class="form-group">
                    <label for="quantity">Quantity *</label>
                    <input type="number" id="quantity" name="quantity" required 
                           min="1" step="1" placeholder="e.g., 100">
                </div>
                
                <div class="form-group">
                    <label for="unit">Unit of Measurement *</label>
                    <select id="unit" name="unit" required>
                        <option value="">Select Unit</option>
                        <option value="PCS">PCS</option>
                        <option value="SET">SET</option>
                        <option value="KG">KG</option>
                        <option value="M">M</option>
                        <option value="M2">M¬≤</option>
                        <option value="M3">M¬≥</option>
                        <option value="EA">EA</option>
                        <option value="BOX">BOX</option>
                        <option value="PAIR">PAIR</option>
                        <option value="OTHER">OTHER</option>
                    </select>
                </div>
            </div>
            
            <div class="button-container">
                <button type="button" class="reset-btn" onclick="resetForm()">Reset Form</button>
                <button type="button" class="submit-btn" onclick="submitToGAS()">Submit to Google Sheet</button>
            </div>
            
            <div id="statusMessage" class="status-message"></div>
        </form>
        
        <!-- Instructions -->
        <div class="status-message info" style="margin-top: 30px; display: block;">
            <strong>üìã How to Use:</strong><br>
            1. Copy the GAS script and deploy it as a web app<br>
            2. Save the web app URL in the Configuration section above<br>
            3. Fill out the form and submit<br>
            4. Data will be added to the correct Google Sheet based on current month
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáèÂ£∞ÊòéÊîæÂú®ÊúÄÂ§ñÂ±Ç
        const SHEET_MAP = {
            '2025-12': '1qXNCBNvO3e8SUxHq8g84ditVSbNRvkw2g1M2C9bWw68',
            '2026-1': '1rO89kIwrjCMzIbIjny8O8nT8kp-WSm6GDZH8CPQZysg',
            '2026-2': '1H6koj_rbNziPupTsg0QrrWhtk6O-Lp7uZ-GQeQStVoE'
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDateInfo();
            loadConfig();
        });
        
        // Update current month/year and target sheet info
        function updateDateInfo() {
            const now = new Date();
            const monthYear = now.toLocaleString('en-US', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            const month = now.getMonth() + 1; // 1-12
            const year = now.getFullYear();
            const key = `${year}-${month}`;
            const sheetId = SHEET_MAP[key] || SHEET_MAP['2025-12'];
            
            document.getElementById('currentMonth').textContent = 
                `Current Month: ${monthYear}`;
            
            // Show short sheet ID
            const shortSheetId = sheetId ? `${sheetId.substring(0, 10)}...` : 'Not found';
            document.getElementById('targetSheetInfo').innerHTML = 
                `Target Google Sheet: <code>${shortSheetId}</code>`;
        }
        
        // Configuration functions
        function saveConfig() {
            const gasUrl = document.getElementById('gasUrl').value.trim();
            const configStatus = document.getElementById('configStatus');
            
            if (!gasUrl || !gasUrl.includes('script.google.com')) {
                configStatus.style.color = '#dc3545';
                configStatus.textContent = 'Please enter a valid Google Apps Script Web App URL';
                configStatus.style.display = 'block';
                return;
            }
            
            // Save to localStorage
            localStorage.setItem('gasWebAppUrl', gasUrl);
            
            configStatus.style.color = '#28a745';
            configStatus.textContent = '‚úì Configuration saved successfully!';
            configStatus.style.display = 'block';
            
            // Hide config section after 2 seconds
            setTimeout(() => {
                configStatus.style.display = 'none';
                document.getElementById('configSection').style.display = 'none';
            }, 2000);
        }
        
        function loadConfig() {
            const savedUrl = localStorage.getItem('gasWebAppUrl');
            if (savedUrl) {
                document.getElementById('gasUrl').value = savedUrl;
                // Hide config section if URL is already saved
                document.getElementById('configSection').style.display = 'none';
            }
        }
        
        // Form submission using fetch API
        async function submitToGAS() {
            const statusDiv = document.getElementById('statusMessage');
            
            // Check configuration
            const gasUrl = localStorage.getItem('gasWebAppUrl');
            if (!gasUrl) {
                statusDiv.className = 'status-message error';
                statusDiv.innerHTML = '‚ùå Please configure the GAS Web App URL first';
                statusDiv.style.display = 'block';
                document.getElementById('configSection').style.display = 'block';
                return;
            }
            
            // Validate form
            if (!validateForm()) {
                return;
            }
            
            // Show loading
            statusDiv.className = 'status-message loading';
            statusDiv.innerHTML = '‚è≥ Submitting data to Google Sheet...';
            statusDiv.style.display = 'block';
            
            // Get form data
            const formData = {
                salesOrder: document.getElementById('salesOrder').value,
                customerName: document.getElementById('customerName').value,
                itemNo: document.getElementById('itemNo').value,
                itemName: document.getElementById('itemName').value,
                dimension: document.getElementById('dimension').value,
                quantity: document.getElementById('quantity').value,
                unit: document.getElementById('unit').value
            };
            
            // Add current month/year and sheet ID
            const now = new Date();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            const key = `${year}-${month}`;
            const sheetId = SHEET_MAP[key] || SHEET_MAP['2025-12'];
            
            // Create URL parameters
            const params = new URLSearchParams();
            params.append('salesOrder', formData.salesOrder);
            params.append('customerName', formData.customerName);
            params.append('itemNo', formData.itemNo);
            params.append('itemName', formData.itemName);
            params.append('dimension', formData.dimension);
            params.append('quantity', formData.quantity);
            params.append('unit', formData.unit);
            params.append('month', month);
            params.append('year', year);
            params.append('sheetId', sheetId);
            
            try {
                // Send to GAS Web App using XMLHttpRequest (better for no-cors)
                const xhr = new XMLHttpRequest();
                xhr.open('POST', gasUrl);
                xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                
                xhr.onload = function() {
                    if (xhr.status === 200 || xhr.status === 0) {
                        // Show success message
                        statusDiv.className = 'status-message success';
                        statusDiv.innerHTML = '‚úÖ Data submitted successfully! Check your Google Sheet for the new tab.';
                        statusDiv.style.display = 'block';
                        
                        // Reset form after success
                        setTimeout(() => {
                            resetForm();
                            statusDiv.style.display = 'none';
                        }, 5000);
                    } else {
                        throw new Error('Request failed');
                    }
                };
                
                xhr.onerror = function() {
                    // Even with error, GAS might have processed it
                    statusDiv.className = 'status-message success';
                    statusDiv.innerHTML = '‚úÖ Data sent to Google Apps Script. Please check your Google Sheet to confirm.';
                    statusDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        resetForm();
                        statusDiv.style.display = 'none';
                    }, 5000);
                };
                
                xhr.send(params.toString());
                
            } catch (error) {
                statusDiv.className = 'status-message error';
                statusDiv.innerHTML = '‚ùå Error submitting data. Please check your configuration.';
                statusDiv.style.display = 'block';
            }
        }
        
        // Validate form
        function validateForm() {
            const requiredFields = ['salesOrder', 'customerName', 'itemNo', 'itemName', 'quantity', 'unit'];
            const statusDiv = document.getElementById('statusMessage');
            
            for (const fieldId of requiredFields) {
                const field = document.getElementById(fieldId);
                if (!field.value.trim()) {
                    statusDiv.className = 'status-message error';
                    statusDiv.innerHTML = `‚ùå Please fill in the ${field.labels[0].textContent}`;
                    statusDiv.style.display = 'block';
                    field.focus();
                    return false;
                }
            }
            
            return true;
        }
        
        // Reset form
        function resetForm() {
            document.getElementById('salesForm').reset();
            document.getElementById('statusMessage').style.display = 'none';
        }
        
        // Function to get sheet name
        function getSheetName() {
            const salesOrder = document.getElementById('salesOrder').value;
            const customerName = document.getElementById('customerName').value;
            const itemNo = document.getElementById('itemNo').value;
            const itemName = document.getElementById('itemName').value;
            
            return `${salesOrder}-${customerName}-${itemNo}-${itemName}`;
        }
    </script>
</body>
</html>
